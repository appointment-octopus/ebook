<!DOCTYPE HTML>
<html lang="pt-br" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>4. Conceitos De Docker - Guia para Devs Deslocados</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../../1_Introdução/index.html"><strong aria-hidden="true">1.</strong> Introdução</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../1_Introdução/1_Sofisticação Técnica - Como se virar/index.html"><strong aria-hidden="true">1.1.</strong> Sofisticação Técnica - Como Se Virar</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../1_Introdução/1_Sofisticação Técnica - Como se virar/1_Resumão.html"><strong aria-hidden="true">1.1.1.</strong> Resumão</a></li><li class="chapter-item "><a href="../../../1_Introdução/1_Sofisticação Técnica - Como se virar/2_Como Googlar.html"><strong aria-hidden="true">1.1.2.</strong> Como Googlar</a></li></ol></li><li class="chapter-item "><a href="../../../1_Introdução/2_Linux/index.html"><strong aria-hidden="true">1.2.</strong> Linux</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../1_Introdução/2_Linux/1_Resumo Linux.html"><strong aria-hidden="true">1.2.1.</strong> Resumo Linux</a></li><li class="chapter-item "><a href="../../../1_Introdução/2_Linux/2_Linux.html"><strong aria-hidden="true">1.2.2.</strong> Linux</a></li><li class="chapter-item "><a href="../../../1_Introdução/2_Linux/3_5_windows wsl.html"><strong aria-hidden="true">1.2.3.</strong> Windows Wsl</a></li><li class="chapter-item "><a href="../../../1_Introdução/2_Linux/3_Dual Boot.html"><strong aria-hidden="true">1.2.4.</strong> Dual Boot</a></li><li class="chapter-item "><a href="../../../1_Introdução/2_Linux/4_Terminal.html"><strong aria-hidden="true">1.2.5.</strong> Terminal</a></li><li class="chapter-item "><a href="../../../1_Introdução/2_Linux/FAQ.html"><strong aria-hidden="true">1.2.6.</strong> Faq</a></li></ol></li><li class="chapter-item "><a href="../../../1_Introdução/3_Git/index.html"><strong aria-hidden="true">1.3.</strong> Git</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../1_Introdução/3_Git/1_Resumão.html"><strong aria-hidden="true">1.3.1.</strong> Resumão</a></li><li class="chapter-item "><a href="../../../1_Introdução/3_Git/2_Git & Github.html"><strong aria-hidden="true">1.3.2.</strong> Git &amp; Github</a></li><li class="chapter-item "><a href="../../../1_Introdução/3_Git/3_Instalação e Configuração.html"><strong aria-hidden="true">1.3.3.</strong> Instalação E Configuração</a></li><li class="chapter-item "><a href="../../../1_Introdução/3_Git/4_Principais comandos.html"><strong aria-hidden="true">1.3.4.</strong> Principais Comandos</a></li><li class="chapter-item "><a href="../../../1_Introdução/3_Git/5_+ Comandos.html"><strong aria-hidden="true">1.3.5.</strong> Comandos</a></li><li class="chapter-item "><a href="../../../1_Introdução/3_Git/6_Sugestão de aliases.html"><strong aria-hidden="true">1.3.6.</strong> Sugestão De Aliases</a></li><li class="chapter-item "><a href="../../../1_Introdução/3_Git/7_FAQ.html"><strong aria-hidden="true">1.3.7.</strong> Faq</a></li></ol></li><li class="chapter-item expanded "><a href="../../../1_Introdução/4_Ambientação/index.html"><strong aria-hidden="true">1.4.</strong> Ambientação</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../1_Introdução/4_Ambientação/1_Arquitetura Cliente-Servidor.html"><strong aria-hidden="true">1.4.1.</strong> Arquitetura Cliente-Servidor</a></li><li class="chapter-item "><a href="../../../1_Introdução/4_Ambientação/2_Projeto Completo em Javascript/index.html"><strong aria-hidden="true">1.4.2.</strong> Projeto Completo Em Javascript</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../1_Introdução/4_Ambientação/2_Projeto Completo em Javascript/1_Backend.html"><strong aria-hidden="true">1.4.2.1.</strong> Backend</a></li><li class="chapter-item "><a href="../../../1_Introdução/4_Ambientação/2_Projeto Completo em Javascript/2_Frontend.html"><strong aria-hidden="true">1.4.2.2.</strong> Frontend</a></li></ol></li><li class="chapter-item expanded "><a href="../../../1_Introdução/4_Ambientação/3_O que é e como utilizar Docker/index.html"><strong aria-hidden="true">1.4.3.</strong> O Que É E Como Utilizar Docker</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../../1_Introdução/4_Ambientação/3_O que é e como utilizar Docker/1_Diferenças entre VMs e Containers.html"><strong aria-hidden="true">1.4.3.1.</strong> Diferenças Entre Vms E Containers</a></li><li class="chapter-item "><a href="../../../1_Introdução/4_Ambientação/3_O que é e como utilizar Docker/2_Construindo um container mínimo.html"><strong aria-hidden="true">1.4.3.2.</strong> Construindo Um Container Mínimo</a></li><li class="chapter-item "><a href="../../../1_Introdução/4_Ambientação/3_O que é e como utilizar Docker/3_Instalação do Docker.html"><strong aria-hidden="true">1.4.3.3.</strong> Instalação Do Docker</a></li><li class="chapter-item expanded "><a href="../../../1_Introdução/4_Ambientação/3_O que é e como utilizar Docker/4_Conceitos de Docker.html" class="active"><strong aria-hidden="true">1.4.3.4.</strong> Conceitos De Docker</a></li><li class="chapter-item "><a href="../../../1_Introdução/4_Ambientação/3_O que é e como utilizar Docker/5_Conceitos de Docker-Compose.html"><strong aria-hidden="true">1.4.3.5.</strong> Conceitos De Docker-Compose</a></li></ol></li><li class="chapter-item "><a href="../../../1_Introdução/4_Ambientação/4_Contribuindo com um repositório Open Source.html"><strong aria-hidden="true">1.4.4.</strong> Contribuindo Com Um Repositório Open Source</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">Guia para Devs Deslocados</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/appointment-octopus/ebook" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="conceitos-de-docker"><a class="header" href="#conceitos-de-docker">Conceitos de Docker</a></h1>
<p><i class="hljs-comment" style="background-color: rgba(0,0,0,0)">Tempo estimado de leitura: 6min</i></p>
<h2 id="dockerfile"><a class="header" href="#dockerfile">Dockerfile</a></h2>
<p>O Dockerfile provê instruções de como se construir a imagem de um container (usando o comando <code>docker build -t &lt;nome_dessa_img&gt; &lt;caminho_do_dockerfile&gt;</code>). Começa a partir de alguma imagem Base (usando o comando <code>FROM</code>), seguido de quaisquer outras instruçoes necessárias</p>
<p>Então, a gente &quot;compila&quot; esse código, tendo como resultado uma imagem que poderemos interagir com.</p>
<h3 id="principais-comandos"><a class="header" href="#principais-comandos">principais comandos</a></h3>
<table style="width: 100%">
<tr>
<th>Comando</th>
<th>Descrição</th>
<th>Uso</th>
</tr>
<tr>
<td><a href="https://docs.docker.com/engine/reference/builder/#arg"><code>ARG</code></a></td>
<td>Define uma variavel que o usuário pode passar ao buildar a imagem (usando a flag <code>--build-arg</code><br /><br />essa variável só fica disponivel nas etapas de build da imagem (ou seja, só no dockerfile, mas nao no container)<br /><br /><blockquote>nao use isso pra passar 'segredos' já que os valores podem ser acessados usando <code>docker history</code></blockquote></td>
<td>
<p>ˢᶦⁿᵗᵃˣᵉ ↴</p>
<pre><code class="language-dockerfile">ARG &lt;name&gt;[=&lt;default value&gt;]
</code></pre>
<p>ᵉˣᵉᵐᵖˡᵒ ↴</p>
<pre><code class="language-dockerfile">ARG version
ARG user_name=admin
</code></pre>
<p>como se usaria:</p>
<pre><code class="language-console">$ docker build --build-arg version=1.0 -t &lt;nome_img&gt; .

$ docker build --build-arg version=1.1 \
               --build-arg user_name=joao \
               -t &lt;nome_img&gt; .
</code></pre>
</td>
</tr>
<tr>
<td><a href="https://docs.docker.com/engine/reference/builder/#env"><code>ENV</code></a></td>
<td>Define uma variavel de ambiente que será utilizada tanto em <i>build-time</i> como em <i>run-time</i> (ou seja, os containers em execução também possuem essa ENV definida). O usuário pode passar o valor utilizando a flag <code>--env</code> ou <code>-e</code><br /><br /><blockquote>nao use ENV caso so precise do valor em <i>build-time</i></blockquote></td>
<td>
<p>ˢᶦⁿᵗᵃˣᵉ ↴</p>
<pre><code class="language-dockerfile">ENV &lt;key&gt;=&lt;value&gt; ...
ENV &lt;key&gt; &lt;value&gt; # com essa sintaxe, apenas um por linha
</code></pre>
<p>ᵉˣᵉᵐᵖˡᵒ ↴</p>
<pre><code class="language-dockerfile">ENV NODE_ENV=&quot;development&quot;

ENV POSTGRES_USER=&quot;username&quot; \
    POSTGRES_PASSWORD=&quot;password&quot; \

ARG build_value
ENV run_value=$build_value
</code></pre>
<p>como se usaria:</p>
<pre><code class="language-bash"># cenario 1
$ docker run --env NODE_ENV=production &lt;nome_img&gt;


# cenario 2
$ docker build --build-arg build_value=5 -t &lt;nome_img&gt; .

$ docker run -e run_value=8 &lt;nome_img&gt;
</code></pre>
</td>
</tr>
<tr>
<td><a href="https://docs.docker.com/engine/reference/builder/#from"><code>FROM</code></a></td>
<td>especifica a imagem base que será utilizada<br /><br />primeiro busca-se essa imagem localmente, caso nao encontre, busca-se no dockerhub o repositorio mais adequado</td>
<td>
<p>ˢᶦⁿᵗᵃˣᵉ ↴</p>
<pre><code class="language-dockerfile">FROM [--platform=&lt;platform&gt;] &lt;image&gt;[:&lt;tag&gt;] [AS &lt;name&gt;]
</code></pre>
<p>ᵉˣᵉᵐᵖˡᵒˢ ↴</p>
<div style="text-align: center">padrão</div>
<pre><code class="language-dockerfile">FROM node:14-alpine
</code></pre>
<br/>
<div style="text-align: center">usando imagem de outro registry (ECR da AWS)</div>
<pre><code class="language-dockerfile">FROM public.ecr.aws/micahhausler/alpine:3.14.0
</code></pre>
<br/>
<div style="text-align: center">recebendo plataformas da cli como <code>ARG</code></div>
<pre><code class="language-dockerfile">ARG architecture
FROM --platform=linux/${architecture} openjdk
</code></pre>
</td>
</tr>
<tr>
<td><a href="https://docs.docker.com/engine/reference/builder/#label"><code>LABEL</code></a></td>
<td>adiciona metadados a imagem.<br />é feito através de pares de key-value (criados por você mesmo)<br /><br />isso pode ser, então, verificado com o comando <a href="#docker-inspect">docker inspect</a></td>
<td>
<p>ˢᶦⁿᵗᵃˣᵉ ↴</p>
<pre><code class="language-dockerfile">LABEL &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...
</code></pre>
<p>ᵉˣᵉᵐᵖˡᵒ ↴</p>
<pre><code class="language-dockerfile">LABEL aleatorio.nome=&quot;valor1&quot;
LABEL aleatorio.data=&quot;valor2&quot;
LABEL chave1=&quot;c1&quot; chave2=&quot;c2&quot; \
      chave3=&quot;c3&quot;
</code></pre>
</td>
</tr>
<tr>
<td><a href="https://docs.docker.com/engine/reference/builder/#workdir"><code>WORKDIR</code></a></td>
<td>define qual será o diretorio de trabalho em <i>build-time</i> (o caminho relativo de qualquer comando <code>RUN</code>, <code>CMD</code>, <code>ENTRYPOINT</code>, <code>COPY</code> e <code>ADD</code> será esse diretório);<br /><br />caso o diretório não exista, este será criado<br /><br />caso passe um caminho relativo (não-absoluto), este será usado em relação ao ultimo <code>WORKDIR</code> definido</td>
<td>
<p>ˢᶦⁿᵗᵃˣᵉ ↴</p>
<pre><code class="language-dockerfile">WORKDIR /path/to/workdir
</code></pre>
<p>ᵉˣᵉᵐᵖˡᵒ ↴</p>
<pre><code class="language-dockerfile">WORKDIR /pasta1
WORKDIR /pasta2
WORKDIR pasta3
</code></pre>
<p>o resultado seria:</p>
<p>.<br />
├── pasta1<br />
└── pasta2<br />
         └── pasta3 &lt;diretorio atual&gt;</p>
</td>
</tr>
<tr>
<td><a href="https://docs.docker.com/engine/reference/builder/#user"><code>USER</code></a></td>
<td>configura qual será o usuário (opcionalmente o grupo, também [caso não especifique, será <i>root</i>]) que será utilizado dali em diante (tanto em <i>build-time</i> como <i>run-time</i>)<br /><br /><blockquote>o usuário tem que ser criado por você previamente no dockerfile</td>
<td>
<p>ˢᶦⁿᵗᵃˣᵉ ↴</p>
<pre><code class="language-dockerfile">USER &lt;user&gt;[:&lt;group&gt;]
</code></pre>
<p>ᵉˣᵉᵐᵖˡᵒ ↴</p>
<pre><code class="language-dockerfile">RUN groupadd -r grupo \
 &amp;&amp; useradd usuario --groups grupo

USER usuario
USER usuario:grupo
</code></pre>
</td>
</tr>
<tr>
<td><a href="https://docs.docker.com/engine/reference/builder/#copy"><code>COPY</code></a></td>
<td>
<p>copia arquivos/diretorios do Host (em relação ao contexto da build) para o Container (em relação ao <code>WORKDIR</code>)<br /></p><br />
<p>pode-se utilizar <em>wildcards</em> nos caminhos advindos do host:</p>
<ul>
<li><code>*</code> da match em qualquer sequencia de chars que não sejam separador (<code>/</code>, ou <code>\</code> no windows)</li>
<li><code>?</code> o mesmo, mas pra 1 char só</li>
</ul>
<blockquote>
<p><code>--chown</code> não funciona no windows<br /><a href="https://sysdig.com/blog/dockerfile-best-practices/">não é mt recomendado o uso disso</a>, já que o usuario só precisa de <strong>permissão pra executar</strong>, e não o <strong>~domínio/ownership</strong><br /><br />para efeito de comparação/entendimento:</p><br />
<ul>
<li><a href="./Dockerfile.COPY_com_chown">exemplo com a flag chown</a></li>
<li><a href="./Dockerfile.COPY_sem_chown">exemplo sem chown</a></li>
</ul>
</blockquote>
</td>
<td>
<p>ˢᶦⁿᵗᵃˣᵉ ↴</p>
<pre><code class="language-dockerfile">COPY [--chown=&lt;user&gt;:&lt;group&gt;] &lt;caminho_no_seu_pc&gt;... &lt;destino_no_container&gt;
COPY [--chown=&lt;user&gt;:&lt;group&gt;] [&quot;&lt;caminho_no_seu_pc&gt;&quot;,... &quot;&lt;destino_no_container&gt;&quot;]
</code></pre>
<p>A versão com <code>[]</code> é utilizada qnd se tem whitespace no path (ex: <code>'/home/joao/minha pasta/'</code>)</p>
<p>ᵉˣᵉᵐᵖˡᵒ ↴</p>
<pre><code class="language-dockerfile">COPY minha_pasta/ /tmp/my_folder
COPY [&quot;package*.json&quot;, &quot;yarn.lock&quot;, &quot;/meu_app/&quot;]
COPY . .
</code></pre>
</td>
</tr>
<tr>
<td><a href="https://docs.docker.com/engine/reference/builder/#add"><code>ADD</code></a></td>
<td>
<p>O mesmo que o <code>COPY</code>, mas:</p>
<ol>
<li>a fonte pode ser uma URL também (não recomendado, melhor usar <code>RUN curl</code> ou <code>RUN wget</code> etc)</li>
<li>auto-extrai arquivos <code>.tar</code></li>
</ol>
<p><a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#add-or-copy">Mais sobre as diferenças aqui.</a></p>
</td>
<td>
<p>ˢᶦⁿᵗᵃˣᵉ ↴</p>
<pre><code class="language-dockerfile">ADD [--chown=&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;
ADD [--chown=&lt;user&gt;:&lt;group&gt;] [&quot;&lt;src&gt;&quot;,... &quot;&lt;dest&gt;&quot;]
</code></pre>
<p>ᵉˣᵉᵐᵖˡᵒ ↴</p>
<pre><code class="language-dockerfile">ADD hom* /mydir/
ADD rootfs.tar.xz /
ADD https://example.com/music.mp3 /usr/src/things/
</code></pre>
</td>
</tr>
<tr>
<td><a href="https://docs.docker.com/engine/reference/builder/#cmd"><code>CMD</code></a></td>
<td>
<p>Provê algum padrão pro container em execução<br /><br />só pode um <code>CMD</code> por dockerfile (caso tenham multiplos apenas o ultimo é considerado)<br /><br />o formato <em>exec</em> não invoca um shell (a nao ser que especifique [ex: <code>CMD [&quot;sh&quot;, &quot;-c&quot;, &quot;echo $HOME&quot;]</code> ])</p>
<blockquote>
<p>justamente por isso, <code>CMD [ &quot;echo&quot;, &quot;$HOME&quot; ]</code> não teria o resultado esperado já que não há um shell pra processar/substituir a variavel</p>
</blockquote>
<td>
<p>ˢᶦⁿᵗᵃˣᵉ ↴</p>
<pre><code class="language-dockerfile"># exec
CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]

# parametros pro ENTRYPOINT
CMD [&quot;param1&quot;,&quot;param2&quot;]

# shell
CMD command param1 param2
</code></pre>
<p>ᵉˣᵉᵐᵖˡᵒ ↴</p>
<pre><code class="language-dockerfile">CMD echo &quot;This is a test.&quot;
CMD [&quot;npm&quot;, &quot;start&quot;]
</code></pre>
</td>
</tr>
<tr>
<td><a href="https://docs.docker.com/engine/reference/builder/#entrypoint"><code>ENTRYPOINT</code></a></td>
<td>
<p>permite configurar um container pra ser rodado como um executavel</p>
</td>
<td>
<p>ˢᶦⁿᵗᵃˣᵉ ↴</p>
<pre><code class="language-dockerfile"># exec
ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]

# shell
ENTRYPOINT command param1 param2
</code></pre>
<p>ᵉˣᵉᵐᵖˡᵒ ↴</p>
<pre><code class="language-dockerfile"># exec
ENTRYPOINT [&quot;top&quot;, &quot;-b&quot;]
CMD [&quot;-c&quot;]

# shell
ENTRYPOINT exec top -b
</code></pre>
</td>
</tr>
</table>
<h3 id="buildkit---segredos"><a class="header" href="#buildkit---segredos">BuildKit - Segredos</a></h3>
<p>No Windows/Mac, BuildKit já é utilizado por padrão; no Linux, não. Para saber como ativar, <a href="https://docs.docker.com/develop/develop-images/build_enhancements/#to-enable-buildkit-builds">leia aqui</a></p>
<p>Caso queira, o comando abaixo verifica se o arquivo de configurações personalizadas já existe e, caso <em>nao</em> exista, cria o mesmo já especificando o uso do Buildkit:</p>
<pre><code class="language-console">$ test -f /etc/docker/daemon.json || (echo '{ &quot;features&quot;: { &quot;buildkit&quot;: true } }' |  sudo tee /etc/docker/daemon.json)
</code></pre>
<p>~~ dar exemplo com segredo do Github, JWT ou bCrypt etc</p>
<h3 id="otimizando-build"><a class="header" href="#otimizando-build">otimizando build</a></h3>
<h4 id="docker-layered-cache"><a class="header" href="#docker-layered-cache">docker layered cache</a></h4>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/4/4f/Tower_of_Hanoi.gif" alt="torre de hanoi" /></p>
<blockquote>
<p>Only the instructions RUN, COPY, ADD create layers. Other instructions create temporary intermediate images, and do not increase the size of the build.</p>
</blockquote>
<p>Docker <em>cacheia</em> as instruções no <code>Dockerfile</code> por camadas. Fazendo um paralelo com a Torre de Hanoi: pense que o Dockerfile é a torre (de cabeça pra baixo); entao, sempre que ouver alteração em alguma linha/camada, todas as peças que estão em cima são descartadas.</p>
<p>Por isso é tão frequente ver a seguinte estrutura em um projeto JS:</p>
<table style="width: 100%">
<tr>
<th>Correto</th>
<th>Incorreto</th>
</tr>
<tr>
<td>
<pre><code class="language-Dockerfile">COPY package*.json .

RUN npm install

COPY . .
</code></pre>
</td>
<td>
<pre><code class="language-Dockerfile">COPY . .

RUN npm install
</code></pre>
</td>
</tr>
</table>
<p>Já que o comando <code>COPY . .</code> copia todos os arquivos, e o código-fonte está em constante alteração, isso significa que toda vez que fosse buildar essa imagem, haver-se-ia de descartar o comando seguinte (<code>npm install</code>), resultando na re-execução desse comando.</p>
<h4 id="comando-onbuild"><a class="header" href="#comando-onbuild">comando onbuild</a></h4>
<h4 id="multistage-build"><a class="header" href="#multistage-build">multistage build</a></h4>
<h3 id="dockerignore"><a class="header" href="#dockerignore">dockerignore</a></h3>
<h2 id="volumes"><a class="header" href="#volumes">volumes</a></h2>
<h2 id="docker-pull"><a class="header" href="#docker-pull">docker pull</a></h2>
<h3 id="registry-x-repositories"><a class="header" href="#registry-x-repositories">registry x repositories</a></h3>
<p>https://stackoverflow.com/a/34004418/11947314</p>
<h2 id="running-a-container"><a class="header" href="#running-a-container">running a container</a></h2>
<h3 id="interactively"><a class="header" href="#interactively">interactively</a></h3>
<h3 id="background"><a class="header" href="#background">background</a></h3>
<h2 id="log-files"><a class="header" href="#log-files">log files</a></h2>
<h2 id="remove-containers"><a class="header" href="#remove-containers">remove containers</a></h2>
<h2 id="remove-images"><a class="header" href="#remove-images">remove images</a></h2>
<h2 id="docker-ps"><a class="header" href="#docker-ps">docker ps</a></h2>
<h2 id="docker-swarm"><a class="header" href="#docker-swarm">docker swarm</a></h2>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../1_Introdução/4_Ambientação/3_O que é e como utilizar Docker/3_Instalação do Docker.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../../1_Introdução/4_Ambientação/3_O que é e como utilizar Docker/5_Conceitos de Docker-Compose.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../1_Introdução/4_Ambientação/3_O que é e como utilizar Docker/3_Instalação do Docker.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../../1_Introdução/4_Ambientação/3_O que é e como utilizar Docker/5_Conceitos de Docker-Compose.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
